{% extends "base.html" %}
{% block body %}

<div class="header">
    <h1>{{ delivery.name }} ({% if delivery.status == delivery.OPEN %}Commandes jusqu'au {{ delivery.order_before|date|capitalize }}{% elif delivery.status == delivery.ADJUSTMENT %}Ajustements en cours{% elif delivery.status == delivery.CLOSED %}Fermée{% else %}Archivée{% endif %})
    </h1>
    <h4>
        Distribution <i class="icon-clock"></i> {{ delivery.from_date|date|capitalize }}, {{ delivery.from_date|time }} - {{ delivery.to_date|time }}, à <i class="icon-streetsign"></i> {{ delivery.where }}.
    </h4>
    <ul class="actions">
        {% include "includes/order_button.html" %}
        {% if request['user'].email == delivery.contact and delivery.status > delivery.EMPTY %}
        <li><a class="button" href="/livraison/{{ delivery.id }}/gérer">Voir la boîte à outils</a></li>
        {% elif request['user'].email in delivery.get_referents() %}
        <li><a class="button" href="/livraison/{{ delivery.id }}/producteurices?referent={{request['user'].email}}">Gérer les produits dont vous vous occupez</a></li>
        {% endif %}
        {% if not delivery.is_archived and delivery.status == delivery.CLOSED %}
        <li>
            <a href="/livraison/{{ delivery.id }}/producteurices.pdf"><i class="icon-ribbon"></i> Bon de commande</a>
        </li>
        <li>
            <a href="/livraison/{{ delivery.id }}/rapport-complet.xlsx"><i class="icon-grid"></i> Rapport complet</a>
        </li>
        <li>
            <a href="/livraison/{{ delivery.id }}/émargement" target="_blank"><i class="icon-document"></i> Résumé de commandes</a>
        </li>
        {% endif %}
        {% if request.user and request.user.is_staff %}
        {% if delivery.is_archived %}
        <li>
            <a href="/livraison/{{ delivery.id }}/désarchiver" class="button danger"><i class="icon-hazardous"></i>&nbsp;Désarchiver</a>
        </li>
        {% endif %}
        <li>
            <a href="/livraison/{{ delivery.id }}/exporter"><i class="icon-layers"></i> Télécharger les infos produits</a>
        </li>
        <li>
            <a href="/livraison/{{ delivery.id }}/edit"><i class="icon-adjustments"></i> Modifier la livraison</a>
        </li>
        <li>
            <a href="/livraison/{{ delivery.id }}/solde"><i class="icon-wallet"></i> Répartition des paiements</a>
        </li>
        {% endif %}
    </ul>
</div>

<ul class="progressbar">
    <li {% if delivery.status == delivery.EMPTY %}class="active"{% endif %}>Mise à jour des prix</li>
    <li {% if delivery.status == delivery.OPEN %}class="active"{% endif %}>Ouverture des commandes</li>
    <li {% if delivery.status == delivery.ADJUSTMENT %}class="active"{% endif %}>Ajustements</li>
    <li {% if delivery.can_generate_reports %}class="active"{% endif %}>Achats par les référent⋅e⋅s</li>
    <li>Distribution</li>
</ul>
<article class="delivery">
{% if delivery.has_products %}
    {% include "includes/delivery_table.html" %}
{% else %}
<div class="placeholder">
    <h2>Aucun produit n'est encore défini pour cette livraison.</h2>
    {% if request.user and request.user.is_staff %}
    <div class="inline-text">
        Pour rajouter des produits, deux options:
        <ol>
            <li><a href="/livraison/{{ delivery.id }}/exporter"><i class="icon-layers"></i>Télécharger le tableur avec les produits</a>, le modifier localement sur votre machine puis &nbsp;<div class="inline-text">{% with unique_id="import-products" %}{% include "includes/modal_import_products.html" %}{% endwith %}</div></li>
            <li>Ou bien ajouter les product⋅eurs⋅rices un⋅e par un⋅e dans l'interface</li>
        </ol>
    </div>
    {% endif %}
</div>
{% endif %}
</article>
<hr>
<ul class="toolbox">
 
</ul>
{% endblock body %}
